heat_template_version: 2017-02-24
description: Simple template to deploy a single compute instance
parameters:
  net:
    description: the network named LSY-network 192.168.2.0/24
    type: string
    default: LSY-network
resources:

  web_secgroup_1:
    type: OS::Neutron::SecurityGroup
    properties:
      rules:
        - protocol: tcp
          remote_ip_prefix: 0.0.0.0/0
          port_range_min: 22
          port_range_max: 22
        - protocol: ICMP
          remote_ip_prefix: 0.0.0.0/0
  web_secgroup_2:
    type: OS::Neutron::SecurityGroup
    properties:
      rules:
        - protocol: tcp
          remote_ip_prefix: 0.0.0.0/0
          port_range_min: 22
          port_range_max: 22
        - protocol: ICMP
          remote_ip_prefix: 0.0.0.0/0
          
  instance_1:
    type: OS::Nova::Server
    properties:
      image: ubuntu_LSY
      flavor: default
      key_name: LSY-SSH
      networks:
        - network:
            get_param: net
      security_groups:
        - default
        - get_resource: web_secgroup_1
  instance_2:
    type: OS::Nova::Server
    properties:
      image: ubuntu_LSY
      flavor: default
      key_name: LSY-SSH
      networks:
        - network:
            get_param: net
      security_groups:
        - default
        - get_resource: web_secgroup_2

  floating_ip_1:
    type: OS::Neutron::FloatingIP
    properties:
      floating_network: public
  floating_ip_2:
    type: OS::Neutron::FloatingIP
    properties:
      floating_network: public

  association_1:
    type: OS::Neutron::FloatingIPAssociation
    properties:
      floatingip_id:
        get_resource: floating_ip_1
      port_id:
        get_attr:
          - instance_1
          - addresses
          - get_param: net
          - 0
          - port
  association_2:
    type: OS::Neutron::FloatingIPAssociation
    properties:
      floatingip_id:
        get_resource: floating_ip_2
        
      port_id:
        get_attr:
          - instance_2
          - addresses
          - get_param: net
          - 0
          - port
          

